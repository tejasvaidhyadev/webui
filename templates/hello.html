<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visual-LLMs for documents</title>
<style>
    body {
        font-family: Arial, sans-serif;
    }
    .tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
  border-radius: 5px;
  margin-bottom: 20px;
}
#coordinatesDisplay {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border: 1px solid blue;
            color: blue;
            border-radius: 5px;
            display: none;
        }


.selectionBox {
    position: absolute;
    border: 1px dashed red;
    background-color: rgba(255, 0, 0, 0.1);
    pointer-events: none;
}


.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 10px 20px;
  transition: 0.3s;
  border-radius: 5px 5px 0 0;
}

.tab button:hover {
  background-color: #ddd;
}

.tab button.active {
  background-color: #ccc;
}

.tabcontent {
  display: none;
  padding: 20px;
  border: 1px solid #ccc;
  border-top: none;
  border-radius: 0 0 5px 5px;
}

.tabcontent.active {
  display: block;
}
.bounding-box {
            position: absolute;
            border: 2px solid red;
            pointer-events: none;
        }

    .container {
        display: flex;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }
    .left-section {
        flex: 0 0 65%;
        padding-right: 20px;
    }
    .right-section {
        flex: 0 0 35%;
        padding-left: 20px;
        border-left: 1px solid #ccc;
    }
    .input-group {
        margin-bottom: 20px;
    }
    .input-group label {
        display: block;
        margin-bottom: 5px;
    }
    .input-group input[type="file"] {
        margin-top: 5px;
    }
    .input-group textarea {
        width: calc(100% - 10px);
        height: 50px;
        resize: none;
    }
    .btn {
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .btn:hover {
        background-color: #0056b3;
    }
    #imagePreview {
        max-width: 100%;
        margin-top: 10px;
    }
    #imagePreview img {
        max-width: 100%;
        max-height: 300px;
    }
    .drag-drop {
        border: 2px dashed #aaa;
        border-radius: 5px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
    }
    #imageInput {
        display: none;
    }
    #companyLogo {
        max-width: 60px;
        margin: 20px auto;
        display: block;
    }
    .decoding-parameters {
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 5px;
    }
    .decoding-parameters h3 {
        margin-top: 0;
    }
    .slider-container {
        margin-bottom: 15px;
    }
    .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 10px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }
    .slider:hover {
        opacity: 1;
    }
    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }
    .slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }
    .center-align {
        text-align: center;
    }

</style>
</head>
<body>
<div class="container">
    <div class="left-section">
        <img src="https://nolano.ai/images/logo/logo.jpg" alt="Nolano Logo" id="companyLogo">
        <!-- Add Nolano on top -->
        <h2>Visual-LLMs for documents</h2>

        <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
        <div id="imagePreview" class="input-group">
            <label for="imageInput" class="drag-drop" ondragover="dragOverHandler(event)" ondrop="dropHandler(event)">
                <p>Drag & Drop Your Document</p>
            </label>
        </div>
        <div class="input-group">
            <label for="textInput">Text Prompt:</label>
            <textarea id="textInput" placeholder="Enter your text prompt here..."></textarea>
        </div>
        <button class="btn" onclick="generateStory()">Submit</button>
        <button class="btn" onclick="clearFields()">Clear</button>
        <div id="output"></div>
    </div>

    <div class="right-section">
      <div class="decoding-parameters">
          <h3>Decoding Parameters</h3>
          <div class="slider-container">
              <label for="temperature">Temperature: <span id="temperatureValue">0.5</span></label>
              <!-- Adjusted temperature slider -->
              <input type="range" min="0" max="1" step="0.01" value="0.5" class="slider" id="temperatureSlider" onchange="updateTemperature()">
          </div>
          <div class="slider-container">
              <label for="tokenLimit">Token Limit: <span id="tokenLimitValue">500</span></label>
              <!-- Adjusted token limit slider -->
              <input type="range" min="10" max="4096" step="1" value="500" class="slider" id="tokenLimitSlider" onchange="updateTokenLimit()">
          </div>
          <div class="tab">
            <button class="tablinks active" onclick="openMode(event, 'docVLLM')">OCR+LLM </button>
            <button class="tablinks" onclick="openMode(event, 'ocrVLLM')">VLLM (Coming soon)</button>
          </div>
          
          <div id="docVLLM" class="tabcontent">
            <!-- Content for Doc_VLLM mode -->
          </div>
          
          <div id="ocrVLLM" class="tabcontent">
            <!-- Content for OCR + VLLM mode -->
          </div> 
      </div>
      <div class="side-title">
        <h3 class="center-align">Blog on Hi-Nolin</h3>
        <!-- QR codes -->
        <div class="qr-codes">
            <!-- Insert QR code images from local path /Users/tejasvaidhya/nolano/webapp/GNWBxQ_qrcode.png -->
            <img src="/Users/tejasvaidhya/nolano/webapp/GNWBxQ_qrcode.png" alt="QR Code for Hi-Nolin" style="max-width: 200px; margin-bottom: 10px; margin-left: 70px;">

        </div>
        <p>Hi-NOLIN, The first state-of-the-art open-source English-Hindi bilingual model. We build upon the Pythia model suite, starting by expanding 7B Pythia architecture to a 9B model.</p>

    </div>

  </div>
  <div id="coordinatesDisplay"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/3.0.0/marked.min.js"></script> <!-- Include marked.js library -->
     
<script>

// // Function to plot bounding boxes
//     function plotBoundingBoxes() {
//     const boundingBoxData = [
//         { label: "Launch now", coordinates: [335, 126, 524, 141] },
//         { label: "Build something people want", coordinates: [335, 165, 570, 180] },
//         // Add other bounding box data here
//     ];

//     const imagePreview = document.getElementById("imagePreview");
//     const image = imagePreview.querySelector("img");

//     boundingBoxData.forEach(data => {
//         const [x, y, width, height] = data.coordinates;
//         const boundingBox = document.createElement("div");
//         boundingBox.className = "bounding-box";
//         boundingBox.style.left = x + "px";
//         boundingBox.style.top = y + "px";
//         boundingBox.style.width = width + "px";
//         boundingBox.style.height = height + "px";
//         imagePreview.appendChild(boundingBox);

//         // Add label if needed
//         const label = document.createElement("div");
//         label.textContent = data.label;
//         label.style.position = "absolute";
//         label.style.left = x + "px";
//         label.style.top = (y - 20) + "px"; // Adjust as needed
//         label.style.color = "red"; // Adjust label styles as needed
//         imagePreview.appendChild(label);
//     });
// }

// Call the function to plot bounding boxes
// plotBoundingBoxes();

function clearFields() {
    document.getElementById("imagePreview").innerHTML = '<label for="imageInput" class="drag-drop" ondragover="dragOverHandler(event)" ondrop="dropHandler(event)"><p>Drag & Drop Your Document</p></label>';
    document.getElementById("textInput").value = "";
    document.getElementById("output").innerHTML = "";
    document.getElementById("imageInput").value = "";
}

function generateStory() {
        var storyInput = document.getElementById('textInput').value;
        var requestData = {
            contents: [
                {
                    parts: [
                        {
                            text: storyInput
                        }
                    ]
                }
            ]
        };

        fetch('/generate_story', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
        // print the response to the console
        .then(response => response.json())
        .then(data => {
            displayStory(data);
            console.log(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function displayStory(data) {
    var outputDiv = document.getElementById('output');
    outputDiv.innerHTML = '';
    if (data && data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
        var story = data.candidates[0].content.parts[0].text;
        var storyParagraph = document.createElement('p');
        storyParagraph.textContent = story;
        outputDiv.appendChild(storyParagraph);

        // Stream the received output and markdownify it
        var markdownStory = '## Story\n\n' + story; // Adding markdown header
        outputDiv.innerHTML = marked(markdownStory); // Assuming marked.js library is used for markdown conversion
    } else {
        outputDiv.textContent = 'Unable to generate story. Please try again.';
    }
}

function handleImageUpload(event) {
    var imageInput = event.target;
    var imagePreview = document.getElementById("imagePreview");
    var file = imageInput.files[0];

    if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
            var img = new Image();
            img.onload = function() {
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                var maxWidth = 400;
                var maxHeight = 400;
                var width = img.width;
                var height = img.height;

                if (width > height) {
                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }
                } else {
                    if (height > maxHeight) {
                        width *= maxHeight / height;
                        height = maxHeight;
                    }
                }

                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);
                var resizedImage = canvas.toDataURL('image/jpeg');

                var imgElement = document.createElement("img");
                imgElement.src = resizedImage;
                imgElement.alt = "Uploaded Image";
                imagePreview.innerHTML = "";
                imagePreview.appendChild(imgElement);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

function streamMarkdownOutput(content, outputDiv) {
    const contentArray = content.split('\n');
    let i = 0;
    const interval = setInterval(() => {
        if (i < contentArray.length) {
            const line = contentArray[i];
            outputDiv.innerHTML += marked(line) + ''; // Append Markdown content with line break
            i++;
        } else {
            clearInterval(interval); // Stop streaming when all lines are appended
        }
    }, 300); // Adjust streaming speed as needed
}

function getImageAndTextPrompt() {
    const bulletPointsHtml = `
<ul>
  <li>Launch now (bounding box: 335, 126, 524, 141)</li>
  <li>Build something people want (bounding box: 335, 165, 570, 180)</li>
  <li>Do things that don't scale (bounding box: 196, 224, 391, 239)</li>
  <li>Find the 90 / 10 solution (bounding box: 335, 267, 539, 282)</li>
  <li>Find 10-100 customers who love your product (bounding box: 335, 306, 606, 321)</li>
  <li>All startups are badly broken at some point (bounding box: 196, 345, 518, 360)</li>
  <li>Write code - talk to users (bounding box: 196, 384, 425, 400)</li>
  <li>"It's not your money" (bounding box: 335, 442, 577, 457)</li>
  <li>Growth is the result of a great product not the precursor (bounding box: 196, 481, 674, 496)</li>
  <li>Don't scale your team/product until you have built something people want (bounding box: 196, 519, 729, 534)</li>
  <li>Valuation is not equal to success or even probability of success (bounding box: 196, 557, 751, 572)</li>
  <li>Avoid long negotiated deals with big customers if you can (bounding box: 196, 596, 751, 611)</li>
  <li>Avoid big company corporate development queries - they will only waste time (bounding box: 196, 634, 788, 650)</li>
  <li>Avoid conferences unless they are the best way to get customers (bounding box: 196, 673, 730, 688)</li>
  <li>Pre-product market fit - do things that don't scale: remain small/nimble (bounding box: 196, 716, 842, 731)</li>
  <li>Startups can only solve one problem well at any given time (bounding box: 335, 774, 662, 789)</li>
  <li>Founder relationships matter more than you think (bounding box: 335, 818, 662, 833)</li>
  <li>Sometimes you need to fire your customers (they might be killing you) (bounding box: 335, 861, 737, 876)</li>
  <li>Ignore your competitors, you will more likely die of suicide than murder (bounding box: 196, 914, 763, 930)</li>
  <li>Most companies don't die because they run out of money (bounding box: 335, 958, 685, 973)</li>
  <li>Be nice! Or at least don't be a jerk (bounding box: 196, 1001, 481, 1016)</li>
  <li>Get sleep and exercise - take care of yourself (bounding box: 335, 1045, 623, 1060)</li>
</ul>
`;

    const pocketGuideMarkdown = `
# The Pocket Guide of Essential YC Advice

- Launch now
- Build something people want
- Do things that don't scale
- Find the 90 / 10 solution
- Find 10-100 customers who love your product
- All startups are badly broken at some point
- Write code - talk to users
- "It's not your money"
- Growth is the result of a great product not the precursor
- Don't scale your team/product until you have built something people want
- Valuation is not equal to success or even probability of success
- Avoid long negotiated deals with big customers if you can
- Avoid big company corporate development queries - they will only waste time
- Avoid conferences unless they are the best way to get customers
- Pre-product market fit - do things that don't scale: remain small/nimble
- Startups can only solve one problem well at any given time
- Founder relationships matter more than you think
- Sometimes you need to fire your customers (they might be killing you)
- Ignore your competitors, you will more likely die of suicide than murder
- Most companies don't die because they run out of money
- Be nice! Or at least don't be a jerk
- Get sleep and exercise - take care of yourself
`;

    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = ""; // Clear previous content
    const imagePreview = document.getElementById("imagePreview");
    const imageInput = document.getElementById("imageInput");

    // Create image element
    if (imageInput.files && imageInput.files[0]) {
        const file = imageInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const image = document.createElement("img");
            image.src = e.target.result;
            image.alt = "Uploaded Image";
            imagePreview.innerHTML = "";
            imagePreview.appendChild(image);
        }
        reader.readAsDataURL(file);
    }

    // Stream Markdown content
    streamMarkdownOutput(bulletPointsHtml, outputDiv);
}

    function dragOverHandler(event) {
        event.preventDefault();
        event.dataTransfer.dropEffect = "copy";
    }

    function updateTemperature() {
    var slider = document.getElementById("temperatureSlider");
    var value = slider.value;
    document.getElementById("temperatureValue").innerText = value;
}

function updateTokenLimit() {
    var slider = document.getElementById("tokenLimitSlider");
    var value = slider.value;
    document.getElementById("tokenLimitValue").innerText = value;
}

    function dropHandler(event) {
        event.preventDefault();
        var files = event.dataTransfer.files;
        var imageInput = document.getElementById("imageInput");
        imageInput.files = files;
        handleImageUpload(event);
    }

    function updateTemperature() {
        var slider = document.getElementById("temperatureSlider");
        var value = slider.value;
        document.getElementById("temperatureValue").innerText = value;
    }

    function updateTokenLimit() {
        var slider = document.getElementById("tokenLimitSlider");
        var value = slider.value;
        document.getElementById("tokenLimitValue").innerText = value;
    }

    // Function to get coordinates on hover
    function getCoordinates(event) {
    var image = event.target;
    var rect = image.getBoundingClientRect(); // Get the position of the image relative to the viewport
    var x = event.clientX - rect.left; // Calculate the x-coordinate relative to the image
    var y = event.clientY - rect.top; // Calculate the y-coordinate relative to the image

    // Display the coordinates
    var coordinatesDisplay = document.getElementById("coordinatesDisplay");
    coordinatesDisplay.style.display = "block";
    coordinatesDisplay.style.left = event.clientX + "px";
    coordinatesDisplay.style.top = event.clientY + "px";
    coordinatesDisplay.textContent = "(" + x + ", " + y + ")";
}

// Add event listener to the image for mousemove event
var imagePreview = document.getElementById("imagePreview");
imagePreview.addEventListener("mousemove", getCoordinates);

// Hide coordinates display when mouse leaves the image
imagePreview.addEventListener("mouseleave", function() {
    var coordinatesDisplay = document.getElementById("coordinatesDisplay");
    coordinatesDisplay.style.display = "none";
});

</script>
</body>
</html>
